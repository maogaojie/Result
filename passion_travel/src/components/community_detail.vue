<template>
<div>
  <html>
    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>- 马蜂窝</title>
      <meta name="keyword" content="长期旅行会影响谈恋爱嘛？" />
      <meta name="renderer" content="webkit" />
      <link
        href="http://css.mafengwo.net/css/cv/css+base:css+jquery.suggest:css+plugins:css+plugins+jquery.jgrowl:css+other+popup:css+app+topbar_v2^alw^1542357401.css"
        rel="stylesheet"
        type="text/css"
      />

      <link
        href="http://css.mafengwo.net/css/cv/css+mfw-ask+detail_v3:css+mfw-ask+img_pop:css+mfw-ask+detail_answer_foldup:css+mfw-ask+upload_pics:css+mfw-ask+pop_answer_success^Ylda^1557212042.css"
        rel="stylesheet"
        type="text/css"
      />

      <link rel="stylesheet" href="http://css.mafengwo.net/css/mfw-ask/invite_user.css?1552011937" />
      <link
        href="http://css.mafengwo.net/css/mfw-footer.css?1558532347"
        rel="stylesheet"
        type="text/css"
      />
    </head>
    <body style="position: relative;">
      <div class="topBar">
        <div class="topBarC">
          <div class="logo">
            <a title="马蜂窝自由行" href="/">马蜂窝自由行</a>
          </div>

          <div class="t_nav">
            <ul id="pnl_nav" data-cs-t="headnav_wo">
              <li data-cs-p="index">
                <strong class="t">
                  <a href="/">首页</a>
                </strong>
              </li>
              <li data-cs-t="wenda" data-cs-p="wenda">
                <strong class="t">
                  <a data-cs-p="from_wo_nav" href="/wenda/">问答</a>
                </strong>
              </li>
              <li data-cs-t="things" data-cs-p="things">
                <strong class="t">
                  <a data-cs-p="from_wo_nav" href="/mall/things.php">马蜂窝周边</a>
                </strong>
              </li>
              <li data-cs-p="together">
                <strong class="t">
                  <a href="/together/">结伴</a>
                </strong>
              </li>
              <li data-cs-p="group">
                <strong class="t">
                  <a href="/group/">小组</a>
                </strong>
              </li>
              <li data-cs-p="mall">
                <strong class="t">
                  <a href="/club/">蜂首俱乐部</a>
                </strong>
              </li>
            </ul>
          </div>
          <div class="t_search">
            <form method="GET" action="/search/q.php" name="search">
              <input type="text" class="key" value name="q" id="word" />
              <input type="submit" value class="btn" />
            </form>
          </div>

          <div class="t_info">
            <div
              id="pagelet-block-23a93ec36a5cd508e2d7f6f156aec4a9"
              class="pagelet-block"
              data-api="apps:user:pagelet:pageViewHeadInfo"
              data-params="{&quot;type&quot;:2}"
              data-async="1"
              data-controller="/js/pageletcommon/pageHeadUserInfoWWWDark"
            >
              <div class="no_login">
                <span>
                  <a href="https://passport.mafengwo.cn">登录</a> /
                  <a href="https://passport.mafengwo.cn/regist.html">注册</a>
                </span>
                <a class="login-qq" href="https://passport.mafengwo.cn/qq"></a>
                <a class="login-weibo" href="https://passport.mafengwo.cn/weibo"></a>
                <a class="login-renren" href="https://passport.mafengwo.cn/renren"></a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div
        class="wrapper"
        data-qid="10733740"
        data-uid="48751372"
        id="_js_wrapper"
        data-is_answer_detail="1"
        data-source="2"
      >
        <div class="detail-wrap clearfix">
          <!-- 问答主要内容 -->
          <div class="col-main">
            <!-- 面包屑导航 -->
            <div class="crumb">
              <a href="/wenda/" target="_blank">马蜂窝问答</a> &gt;
              <span>{{bar_list.forum_name}}</span>
            </div>

            <!-- 问题区域 -->
            <div class="q-detail" id="_js_askDetail">
              <!-- 问题详情 -->
              <div class="q-content">
                <div class="q-title">
                  <a href="/wenda/area-187613.html" target="_blank" class="location">
                    <i></i>全球
                  </a>
                  <h1>
                    <a href="/wenda/detail-10733740.html">{{bar_list.forum_name}}</a>
                  </h1>
                </div>
                <div class="q-desc">
                  <div v-html="bar_list.forum_text"></div>
                </div>
                <div class="q-info1 clearfix">
                  <div class="q-tags fl">
                    <a class="a-tag" href="/wenda/area-14383.html" target="_blank">欧洲</a>
                  </div>
                  <div class="pub-bar fr">
                    <a href="/wenda/u/48751372/answer.html" class="photo" target="_blank">
                      <img :src="bar_list.user.image_name" width="16" height="16" />
                    </a>
                    <a
                      class="name"
                      href="/wenda/u/48751372/answer.html"
                      target="_blank"
                    >{{bar_list.user.name}}</a>
                    <span class="time">
                      <span>2018-01-10 19:14:34</span>
                    </span>
                  </div>
                </div>
              </div>

              <div class="q-operate clearfix">
                <div class="fl">
                  <!-- 问题分享 -->
                  <div class="q-share cate-share">
                    <a class="_js_showShare">
                      <i class="q-share-icon"></i>分享
                    </a>
                    <div
                      class="share-pop _j_share_pop hide clearfix"
                      data-title="长期旅行会影响谈恋爱嘛？"
                      data-qid="10733740"
                    >
                      <a title="分享到新浪微博" class="sina _j_do_share" data-site="wb"></a>
                      <a title="分享到QQ空间" class="zone _j_do_share" data-site="qz"></a>
                      <a title="分享到微信" class="weixin _j_do_share_wx" data-site="wx"></a>
                    </div>
                  </div>

                  <!-- 举报 -->
                  <div class="admin_hide tip-off">
                    <a
                      data-japp="report"
                      data-refer="http://www.mafengwo.cn/wenda/detail-10733740.html"
                      data-refer-uid="48751372"
                      data-app="qa.question"
                      data-busi-id="qid:10733740"
                    >举报</a>
                  </div>
                </div>
                <div class="fr">
                  <span class="atten-num">212640浏览</span>
                  <span class="atten-num">
                    <span class="_j_same_num">38</span>人关注
                  </span>

                  <a class="btn-atten _j_same_question" rel="nofollow" data-status="1">
                    <span>关注</span>
                  </a>

                  <a class="btn-answer _j_btn_goanswer" rel="nofollow">回答</a>
                </div>
              </div>

              <!-- 修改问题内容 -->

              <div class="qa-bar-wrap _j_qaBar hide" style="display: none;">
                <div class="qa-bar-content">
                  <div class="q-operate">
                    <span class="atten-num">212640浏览</span>
                    <span class="atten-num">
                      <span class="_j_same_num">38</span>人关注
                    </span>

                    <a class="btn-atten _j_same_question" rel="nofollow" data-status="1">
                      <span>关注</span>
                    </a>

                    <a class="btn-answer _j_btn_goanswer" rel="nofollow">回答</a>
                  </div>
                  <div class="q-title">
                    <a href="/wenda/area-187613.html" target="_blank" class="location">
                      <i></i>全球
                    </a>
                    <h1>长期旅行会影响谈恋爱嘛？</h1>
                  </div>
                </div>
              </div>
            </div>
            <!-- 回答区域 -->
            <div class="answer-wrap">
              <div class="hd">
                <a href="/wenda/detail-10733740.html" class="view_all">查看全部236个回答</a>
                <div style="display:none;">
                  <span id="_j_anum">236</span>个回答
                </div>
              </div>

              <div class="bd _j_pager_box">
                <ul class="answer-list answer_detail">
                  <!-- 回答列表 -->
                  <div
                    id="normal_answer_wrap"
                    class="pagelet-block"
                    data-controller="/js/qa/ControllerDetailAnswerList"
                  >
                    <li
                      class="answer-item clearfix _j_answer_item _js_answer10819536"
                      v-for="i in bar"
                      :key="i.index"
                    >
                      <div class="answer-content _js_answer_content">
                        <div class="answer-info clearfix">
                          <div class="user-bar fl">
                            <a
                              class="_j_filter_click avatar"
                              href="/wenda/u/92800901/answer.html"
                              target="_blank"
                            >
                              <img :src="i.user.image_name" width="48" height="48" class="photo" />
                            </a>
                            <a
                              class="name"
                              href="/wenda/u/92800901/answer.html"
                              target="_blank"
                            >{{i.user.name}}</a>
                            <a
                              class="level"
                              href="/rank/lv.php?uid=92800901"
                              target="_blank"
                              rel="nofollow"
                            >LV.23</a>
                          </div>
                        </div>
                        <!-- 回答内容 -->
                       
                      </div>
                      <!-- 问答版权名片 -->
                  

                      <div class="comment-wrap _js_comments is_foldup_detail">
                        <b class="arrow">
                          <i></i>
                        </b>
                        <div class="_js_comment_list">
                          <h3 class="comment-title">热门评论</h3>
                          <ul class="comment-list _j_comment_list_ul">
                            <li class="comment-item clearfix" v-for="x in i.reple" :key="x.index">
                              <div class="comment-user">
                                <a href="/u/82690212.html" target="_blank">
                                  <img :src="x.image_name" class="photo" />
                                </a>
                              </div>
                              <dl>
                                <dt>
                                  <a
                                    href="/u/82690212.html"
                                    target="_blank"
                                    class="c-name"
                                  >{{x._user}}</a>
                                  <a
                                    href="/rank/lv.php?uid=82690212"
                                    class="level"
                                    target="_blank"
                                  >LV.5</a>
                                  : {{x.name}}
                                </dt>
                                <dd>
                                  <div class="c-info">
                                    <span class="c-time fl">2018-07-14 10:26</span>
                                    <span
                                      class="c-like _j_comment_like"
                                      data-cid="12254962"
                                      data-num="7"
                                    >
                                      <a class="btn-like"></a>
                                      7
                                    </span>
                                    <a
                                      class="c-reply _j_publish_reply fr"
                                      @click="red(x._user,i.user.id)"
                                    >回复</a>
                                    <a
                                      class="c-report fr"
                                      data-japp="report"
                                      data-refer="http://www.mafengwo.cn/wenda/detail-10733740-10819536.html"
                                      data-refer-uid="82690212"
                                      data-app="qa.answer.comment"
                                      data-busi-id="cid:12254962"
                                    >举报</a>
                                  </div>
                                </dd>
                              </dl>
                            </li>
                          </ul>
                        </div>
                        <div class="comment-more _j_more" style="display: none;">
                          <a class="_js_more_comments">查看更多&gt;&gt;</a>
                        </div>
                        <div
                          class="comment-page _js_comment_pagination hide"
                          data-comment_total="31"
                          style="display: block;"
                        ></div>
                        <div class="comment-add clearfix _j_word">
                          <textarea class="_j_content _j_word_check" :id="i.user.id"></textarea>
                          <span class="word-count">
                            <span class="_j_word_num">0</span>/
                            <span class="_j_max_num">600</span> 字
                          </span>
                          <input
                            class="btn-comment _j_publish_comment"
                            type="button"
                            value="回复"
                            @click="reply(i.user.id,i.user.name)"
                          />
                        </div>
                      </div>
                    </li>
                  </div>
                </ul>
              </div>
            </div>
            <div class="answer-add clearfix">
              <a name="answer"></a>
              <div class="aa-hd">
                <a class="aa-avatar" href="/wenda/u/94635717/answer.html">
                  <img
                    src="http://p1-q.mafengwo.net/s15/M00/2E/4C/CoUBGV3eaGaATeVCAAIcbPrr51w03.jpeg?imageMogr2%2Fthumbnail%2F%2148x48r%2Fgravity%2FCenter%2Fcrop%2F%2148x48%2Fquality%2F90"
                    class="photo"
                  />
                </a>
                <a class="aa-name">王大锤</a>
              </div>
              <!-- 工具栏容器 -->
              <div id="toolbar-container"></div>

              <!-- 编辑器容器 -->
              <div id="editor">
                <p>This is the initial editor content.</p>
              </div>
              <div class="aa-ft">
                <input
                  class="btn-comment _j_submit_answer_btn"
                  type="button"
                  value="提交回答"
                  @click="commit(bar_list.id)"
                />
              </div>
            </div>
            
          </div>

          <!-- 问答页面侧边栏 -->
          <div class="col-side" id="_js_right_side">
            <!-- 我要提问 -->
            <div class="btn-question">
              <router-link :to="{name:'post_bar'}">我要提问</router-link>
            </div>
            <div class="author_about">
              <div class="tit">关于作者</div>
              <div class="bd">
                <a href="/wenda/u/92800901/answer.html" target="_blank">
                  <img
                    src="http://b1-q.mafengwo.net/s13/M00/89/1F/wKgEaVy8greAbjl5ACLfDpnSYcY71.jpeg?imageMogr2%2Fthumbnail%2F%2148x48r%2Fgravity%2FCenter%2Fcrop%2F%2148x48%2Fquality%2F90"
                  />
                </a>

                <a class="ah_name">羊咸咸</a>
                <a href="/rank/lv.php?uid=92800901" target="_blank" class="ah_level">LV.23</a>
                <div class="ah_txt">
                  愿生活历久弥新
                  微博...
                </div>
                <a
                  class="ah_btn"
                  data-follow_class="attened"
                  data-japp="following"
                  data-uid="92800901"
                >
                  <span class="already">已</span>关注
                </a>
              </div>
            </div>

   

            <div style="margin-top:0px;margin-bottom: 20px;">
              <div
                id="pagelet-block-f32ea308aa41210ae855e2a4292fe956"
                class="pagelet-block"
                data-api=":qa:pagelet:ads"
                data-params="{&quot;mddid&quot;:187613,&quot;tags&quot;:[&quot;\u6b27\u6d32&quot;]}"
                data-async="1"
                data-controller
              ></div>
            </div>
          </div>
        </div>
      </div>

      <div id="float-pannel-gloable">
        <img
          class="float-image"
          src="https://p4-q.mafengwo.net/s14/M00/BB/8C/wKgE2l0r2W-ALHaeAACAt6lqXyA464.png"
          style="width:178px;"
        />
        <div class="float-btn">
          <img
            id="closed"
            src="https://n4-q.mafengwo.net/s13/M00/46/AC/wKgEaVy2xHeAZJhRAAADGY-wozY871.png"
          />
        </div>
      </div>

      <foot></foot>

      <link
        href="http://css.mafengwo.net/css/mfw-toolbar.css?1537192876"
        rel="stylesheet"
        type="text/css"
      />
    </body>
  </html>
</div>
</template>
<script>
import { send, sendToken } from "../../static/js/comm";
import foot from "@/components/foot";
import header from "@/components/header";
import CKEditor from "@ckeditor/ckeditor5-build-decoupled-document";
import "@ckeditor/ckeditor5-build-decoupled-document/build/translations/zh-cn"; //中文包
export default {
  data: function() {
    return {
      editor:null,//编辑器实例
      bar_list: "",
      comments: "",
      forum_id: "",
      bar: "",
      content: "",
      comment: "",
      uid: ""
    };
  },
  mounted() {
    this.initCKEditor();
    this.forum_id = this.$route.query.id;
    send("http://47.97.203.203:8000/user/one_forum/", "post", {
      id: this.forum_id
    }).then(res => {
      if (res.data.code == 200) {
        this.bar_list = res.data.all_forum;
      }
    });
    send("http://47.97.203.203:8000/user/allreple/", "post", {
      forum_id: this.forum_id
    }).then(res => {
      if (res.data.code == 200) {
        this.bar = res.data.reple;
      }
    });
  },
  components: {
    foot: foot,
    header1: header
  },
  methods: {
    red: function(name, id) {
      $("#" + id).clear;
      var comment = "回复 @" + name + ":";
      $("#" + id).val(comment);
      this.uid = id;
    },
    reply: function(id, name) {
      console.log(id, name);
      var contents = $("#" + id).val();

      // sendToken("http://47.97.203.203:8000/user/addcomment/", "post", {
      //   comment_text: this.comment,
      //   reple_id: id,
      //   user_id: localStorage.getItem("user_id")
      // });
    },
    commit: function(id) {
      var user = this.bar.id;
      console.log(user);
      console.log(id);
      if (user != undefined) {
        alert("一个问题只能回答一次");
      } else {
        sendToken("http://47.97.203.203:8000/user/addreple/", "post", {
          reple_text: $("#editor").attr("value"),
          user_id: localStorage.getItem("user_id"),
          forum_id: id
        }).then(res => {
          if (res.data.code == 200) {
            alert("评论成功");
          }
        });
      }
    },
    initCKEditor() {
        CKEditor.create(document.querySelector('#editor'), {
          ckfinder: {
            uploadUrl: '/admin/Upload/uploadUrl'
            //后端处理上传逻辑返回json数据,包括uploaded(选项true/false)和url两个字段
          }
        }).then(editor => {
          const toolbarContainer = document.querySelector('#toolbar-container');
          toolbarContainer.appendChild(editor.ui.view.toolbar.element);
          this.editor = editor //将编辑器保存起来，用来随时获取编辑器中的内容等，执行一些操作
        }).catch(error => {
          console.error(error);
        });
     },
  }
};
</script>